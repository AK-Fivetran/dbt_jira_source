version: 2

# todo: add docs + tests for stg models
models:
  - name: stg_jira__comment
    description: Table of comments made on issues.
    columns:
      - name: comment_id 
        description: Unique ID of the comment.
        tests:
          - unique
          - not_null
      - name: author_user_id
        description: Foreign key referencing the `user` id of the comment's author.
      - name: body
        description: Content of the comment.
      - name: created_at
        description: Timestamp of when the comment was created. TODO - get timezone clarification
      - name: is_public
        description: Boolean that is true if the comment is visible to all users.
      - name: issue_id 
        description: Foreign key referencing the id of the `issue` that was commented on.
      - name: last_update_user_id
        description: Foreign key referencing the id of the `user` who last updated this comment.
      - name: last_updated_at 
        description: Timestamp of when the comment was last updated.

  - name: stg_jira__component
    description: Table of project components (subsections to group issues).
    columns:
      - name: component_id
        description: ID of the component.
      - name: component_description
        description: Description given to the component.
      - name: component_name
        description: UI-facing name of the component.
      - name: project_id
        description: Foreign key referencing the id of the component's `project`.

  - name: stg_jira__field 
    description: Table of all issue fields.
    columns:
      - name: field_id
        description: >
          Unique ID of the field. Default fields will have descriptive IDs, whereas custom
          field IDs will be `'customfield_#####'`.
        tests:
          - unique
          - not_null
      - name: is_array
        description: Boolean that is true if a field can have multiple values (is mulitselect).
      - name: is_custom
        description: >
          Boolean that is true if the field is custom to this organization, and false if 
          it is default to Jira.
      - name: field_name
        description: Name of the field as it appears on issue cards.

  - name: issue
    description: Table of all issues in your organization's Jira (captures soft deletes).
    columns:
      - name: issue_id
        description: Unique ID of the issue. 
      - name: assignee_user_id
        description: Foreign key referencing the ID of the `user` currently assigned to this task.
      - name: created_at
        description: Timestamp of when the issue was created (in UTC).
      - name: creator_user_id
        description: Foreign key referencing the `user` who first created the issue. Cannot be changed.
      - name: description
        description: The issue description, if given.
      - name: issue_description
        description: Calendar day on which the issue is due, if a due date is provided.
      - name: environment
        description: Text field describing the environment in which the issue occurred (ie "IE9 on Windows 7").
      - name: issue_type_id
        description: Foreign key referencing the ID of the `issue_type`. 
      - name: issue_key
        description: UI-facing id of the issue.
      - name: original_estimate_seconds
        description: The original estimate of how long working on this issue would take, in seconds.
      - name: parent_issue_id
        description: Self-referencing ID of the parent `issue`. 
      - name: priority_id
        description: Foreign key referencing the ID of the issue's current `priority`.
      - name: project_id
        description: Foreign key referencing the ID of the `project` that the issue belongs to.
      - name: remaining_estimate_seconds
        description: The estimate of how much longer working on this issue will take, in seconds.
      - name: reporter_user_id
        description: >
          Foreign key referencing the ID of the `user` who reported the issue. This differs from the `creator` column 
          in that the reporter can be changed in-app.
      - name: resolution_id
        description: Foreign key referencing the ID of the issue's type of `resolution`.
      - name: resolved_at
        description: >
          Timestamp of when the issue was resolved (ie completed, marked as duplicate). If an issue
          is un-resolved, this will be null.
      - name: status_id
        description: >
          Foreign key referencing the ID of the issue's `status` (the step that the issue is currently at 
          in the project's workflow).
      - name: status_changed_at
        description: Timestamp of when the status was last changed.
      - name: issue_name
        description: Title of the issue.
      - name: time_spent_seconds
        description: The time that was spent working on this issue, in seconds.
      - name: updated_at
        description: Timestamp of when the issue was last updated in some way.
      - name: work_ratio
        description: >
          The percentage of work that has been logged against the issue (time_spent) vs the original estimate of worktime.
          Equals -1.0 when the fields required for calculation are not provided.